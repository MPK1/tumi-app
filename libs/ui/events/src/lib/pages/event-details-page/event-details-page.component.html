<mat-progress-bar
  mode="indeterminate"
  *ngIf="(event$ | async) === null"
></mat-progress-bar>
<main *ngIf="event$ | async as event" class="bg-white">
  <a
    mat-fab
    routerLink="run"
    class="extended-fab"
    *ngIf="event.userIsOrganizer"
  >
    <mat-icon svgIcon="icon-user-shield"></mat-icon>
    <span class="label">Run Event</span>
  </a>
  <button
    mat-fab
    (click)="showCode()"
    class="extended-fab"
    *ngIf="event.userRegistered"
  >
    <mat-icon svgIcon="icon-two-tickets" class="mr-2"></mat-icon>
    <span class="label">Check in</span>
  </button>
  <tumi-event-header
    [event]="event"
    class="
      p-4
      lg:p-6
      pb-20
      lg:pb-24
      text-white
      bg-gradient-to-br
      from-gray-600
      to-gray-800
      dark-button
    "
  ></tumi-event-header>
  <!--  TODO: get rid of the 10 character check here -->
  <div class="p-4 lg:p-6 mx-2 lg:mx-6 -mt-16">
    <mat-accordion displayMode="flat" [multi]="event.couldBeOrganizer">
      <mat-expansion-panel
        [expanded]="
          (!event.userRegistered && !event.userIsOrganizer) ||
          event.participantText.length < 10
        "
      >
        <mat-expansion-panel-header>
          <mat-panel-title>Description</mat-panel-title>
        </mat-expansion-panel-header>
        <markdown
          [data]="event.description"
          class="prose lg:prose-xl break-words"
        ></markdown>
      </mat-expansion-panel>
      <mat-expansion-panel *ngIf="event.couldBeOrganizer" [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Information for organizing</mat-panel-title>
        </mat-expansion-panel-header>
        <markdown
          [data]="event.organizerText"
          class="prose lg:prose-xl break-words"
        ></markdown>
      </mat-expansion-panel>
      <mat-expansion-panel
        *ngIf="
          event.participantText.length > 10 &&
          (event.userRegistered || event.userIsOrganizer)
        "
        [expanded]="event.userRegistered || event.userIsOrganizer"
      >
        <mat-expansion-panel-header>
          <mat-panel-title>Info for participants</mat-panel-title>
        </mat-expansion-panel-header>
        <markdown
          [data]="event.participantText"
          class="prose lg:prose-xl break-words"
        ></markdown>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <!--  <div class="bg-white rounded-2xl p-4 lg:p-6 mx-2 lg:mx-6 -mt-16">-->
  <!--    <markdown-->
  <!--      [data]="event.description"-->
  <!--      class="prose lg:prose-xl break-words"-->
  <!--    ></markdown>-->
  <!--  </div>-->
  <div class="p-6 lg:px-12">
    <p>{{ event.organizer.text }}</p>
  </div>
  <div class="p-6 lg:p-12 bg-gray-100 shadow-inner">
    <ng-template #noRegistration>
      <h2>You can not sign up for this event</h2>
      <ng-container *ngIf="(hasAccount$ | async) === false">
        <p class="my-4">To sign up for events please create an account</p>
        <a routerLink="/profile/new" mat-flat-button color="accent">
          Create Account
        </a>
      </ng-container>
    </ng-template>
    <ng-container *ngIf="event.couldBeParticipant; else noRegistration">
      <h2 class="text-blue-600 mb-4 font-black">Registration</h2>
      <ng-container [ngSwitch]="event.registrationMode">
        <tumi-external-event-registration
          *ngSwitchCase="RegistrationMode.External"
          [event]="event"
        >
        </tumi-external-event-registration>
        <tumi-stripe-registration
          *ngSwitchCase="RegistrationMode.Stripe"
          [event]="event"
        ></tumi-stripe-registration>
        <tumi-online-event-registration
          [event]="event"
          *ngSwitchCase="RegistrationMode.Online"
        ></tumi-online-event-registration>
      </ng-container>
    </ng-container>
  </div>
  <div
    *ngIf="
      event.couldBeOrganizer &&
      event.registrationMode !== RegistrationMode.External
    "
    class="p-6 lg:p-12 bg-gray-100 border-t-2"
  >
    <h2 class="text-blue-600 mb-4">Sign up as organizer</h2>
    <div fxLayout.gt-md="row" fxLayout="column" fxLayoutGap="1rem">
      <button
        mat-raised-button
        color="accent"
        class="w-full"
        [disabled]="!event.organizerRegistrationPossible"
        (click)="registerAsOrganizer()"
      >
        Sign up now
      </button>
      <div fxFlex="50">
        <h3>Organizers already on this event</h3>
        <mat-list>
          <mat-list-item *ngIf="event.organizers.length === 0">
            Nobody yet
          </mat-list-item>
          <mat-list-item *ngFor="let user of event.organizers">
            {{ user.fullName }}
          </mat-list-item>
        </mat-list>
      </div>
    </div>
  </div>
</main>
