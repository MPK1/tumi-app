<main class="p-4">
  <div fxLayout="row" fxLayoutAlign="start center">
    <a routerLink=".." mat-icon-button>
      <mat-icon svgIcon="icon-circled-chevron-left"></mat-icon>
    </a>
    <h1>Edit event</h1>
  </div>

  <div class="my-8 py-4 px-4 border-2 rounded-lg">
    <h2 class="mb-2">Publication management</h2>
    <form [formGroup]="publicationForm" (ngSubmit)="changePublication()">
      <mat-form-field class="w-full">
        <mat-label>Publication state</mat-label>
        <mat-select formControlName="publicationState">
          <mat-option [value]="PublicationState.Draft">Draft</mat-option>
          <mat-option [value]="PublicationState.Approval" disabled
            >Ready for approval</mat-option
          >
          <mat-option [value]="PublicationState.Organizers"
            >Visible to Organizers</mat-option
          >
          <mat-option [value]="PublicationState.Public">Public</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="mt-4">
        <button type="submit" mat-flat-button color="primary">
          Save Changes
        </button>
      </div>
    </form>
  </div>
  <div
    class="my-8 py-4 px-4 border-2 rounded-lg"
    *ngIf="event$ | async as event"
  >
    <h2 class="mb-2">Event location</h2>
    <p>{{ event.location }}</p>
    <p>{{ event.coordinates | json }}</p>
    <a
      mat-stroked-button
      href="http://www.google.com/maps/place/{{ event.coordinates?.lat }},{{
        event.coordinates?.lon
      }}"
      target="_blank"
    >
      Open in maps
    </a>
    <button mat-flat-button color="primary" (click)="updateLocation()">
      Update Location
    </button>
  </div>
  <div class="my-8 py-4 px-4 border-2 rounded-lg">
    <h2 class="mb-2">General information</h2>
    <form [formGroup]="generalInformationForm" (ngSubmit)="onSubmit()">
      <mat-form-field class="w-full">
        <mat-label>Event Title</mat-label>
        <input matInput formControlName="title" type="text" />
      </mat-form-field>
      <mat-form-field class="w-full">
        <mat-label>Event Icon</mat-label>
        <input matInput formControlName="icon" type="text" />
        <img
          [src]="iconValue | iconURL"
          alt="icon"
          matSuffix
          width="24px"
          height="24px"
        />
      </mat-form-field>
      <div fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="1rem">
        <mat-form-field class="w-full">
          <mat-label>Event Start</mat-label>
          <input matInput formControlName="start" type="datetime-local" />
        </mat-form-field>
        <mat-form-field class="w-full">
          <mat-label>Event End</mat-label>
          <input matInput formControlName="end" type="datetime-local" />
        </mat-form-field>
      </div>
      <mat-form-field class="w-full">
        <mat-label>Event Description</mat-label>
        <textarea matInput formControlName="description" rows="10"></textarea>
      </mat-form-field>
      <mat-form-field class="w-full">
        <mat-label>Organizer Help</mat-label>
        <textarea matInput formControlName="organizerText" rows="10"></textarea>
        <mat-hint>This text is visible to potential organizers</mat-hint>
      </mat-form-field>
      <mat-form-field class="w-full">
        <mat-label>Info for Participants</mat-label>
        <textarea
          matInput
          formControlName="participantText"
          rows="10"
        ></textarea>
        <mat-hint>This text is only visible to registered Users</mat-hint>
      </mat-form-field>
      <div fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="1rem">
        <mat-form-field class="w-full">
          <mat-label>Organizing Institution</mat-label>
          <mat-select formControlName="eventOrganizerId">
            <mat-option
              *ngFor="let organizer of organizers$ | async"
              [value]="organizer.id"
              >{{ organizer.name }}</mat-option
            >
          </mat-select>
        </mat-form-field>
        <mat-form-field class="w-full">
          <mat-label>Registration Mode</mat-label>
          <mat-select formControlName="registrationMode" required>
            <mat-option [value]="RegistrationMode.External">{{
              RegistrationMode.External | titlecase
            }}</mat-option>
            <mat-option [value]="RegistrationMode.Stripe">{{
              RegistrationMode.Stripe | titlecase
            }}</mat-option>
            <mat-option [value]="RegistrationMode.Online">{{
              RegistrationMode.Online | titlecase
            }}</mat-option>
          </mat-select>
          <mat-hint>Select how users will register for this event</mat-hint>
        </mat-form-field>
      </div>
      <div fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="1rem">
        <mat-checkbox formControlName="esnDiscount">
          Has ESNcard discount
        </mat-checkbox>
        <mat-form-field class="w-full">
          <mat-label>Discounted Price</mat-label>
          <input
            matInput
            formControlName="discountedPrice"
            type="number"
            required
          />
          <span matSuffix>€</span>
          <mat-hint
            >The price users have to pay for this event if they get the
            discount</mat-hint
          >
          <mat-error>
            You have to specify a price or change the registration type
          </mat-error>
        </mat-form-field>
      </div>
      <div fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="1rem">
        <mat-form-field class="w-full">
          <mat-label>Price</mat-label>
          <input matInput formControlName="price" type="number" required />
          <span matSuffix>€</span>
          <mat-hint>The price users have to pay for this event</mat-hint>
          <mat-error>
            You have to specify a price or change the registration type
          </mat-error>
        </mat-form-field>
        <mat-form-field class="w-full">
          <mat-label>Registration link</mat-label>
          <input
            matInput
            formControlName="registrationLink"
            type="url"
            required
          />
          <mat-hint>The link where users can register for this event</mat-hint>
          <mat-error>
            You have to specify a link or change the registration type
          </mat-error>
        </mat-form-field>
      </div>
      <div fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="1rem">
        <mat-form-field class="w-full">
          <mat-label>Number of organizers</mat-label>
          <input
            matInput
            formControlName="organizerLimit"
            type="number"
            required
          />
          <mat-hint>Maximum number of students that can sign up</mat-hint>
          <mat-error>
            You have to set the maximum number of participants
          </mat-error>
        </mat-form-field>
        <mat-form-field class="w-full">
          <mat-label>Number of participants</mat-label>
          <input
            matInput
            formControlName="participantLimit"
            type="number"
            required
          />
          <mat-hint>Maximum number of organizers that can sign up</mat-hint>
          <mat-error>
            You have to set the maximum number of organizers
          </mat-error>
        </mat-form-field>
      </div>
      <div class="mt-4">
        <button type="submit" mat-flat-button color="primary">
          Save Changes
        </button>
      </div>
    </form>
  </div>
  <div
    class="my-8 py-4 px-4 border-2 rounded-lg"
    *ngIf="event$ | async as event"
  >
    <div
      fxLayoutGap="1rem"
      fxLayout="row"
      fxLayoutAlign="start center"
      class="mb-2"
    >
      <h2>Additional userdata</h2>
      <button mat-icon-button>
        <mat-icon svgIcon="icon-add" (click)="addSubmission()"></mat-icon>
      </button>
    </div>
    <mat-list>
      <mat-list-item *ngFor="let item of event.submissionItems">
        <h3 mat-line>{{ item.name }}</h3>
        <p mat-line>{{ item.type }} | {{ item.submissionTime }}</p>
      </mat-list-item>
    </mat-list>
  </div>
  <div class="my-8 py-4 px-4 border-2 rounded-lg">
    <div
      fxLayoutGap="1rem"
      fxLayout="row"
      fxLayoutAlign="start center"
      class="mb-2"
    >
      <h2>Assigned Organizers</h2>
      <button mat-icon-button>
        <mat-icon svgIcon="icon-add" (click)="addOrganizer()"></mat-icon>
      </button>
    </div>

    <mat-list class="max-w-lg">
      <mat-list-item *ngFor="let user of (event$ | async)?.organizers">
        <img
          [src]="user.picture"
          alt="Image"
          referrerpolicy="no-referrer"
          mat-list-avatar
        />
        <p mat-line>{{ user.fullName }}</p>
        <button mat-icon-button (click)="removeUser(user.id)">
          <mat-icon svgIcon="icon-delete-sign"></mat-icon>
        </button>
      </mat-list-item>
    </mat-list>
  </div>
</main>
