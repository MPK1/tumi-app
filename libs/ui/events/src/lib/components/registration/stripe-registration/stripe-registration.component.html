<div *ngIf="event" class="my-2">
  <p class="mb-4">
    Free spots:
    {{ (event?.participantLimit ?? 0) - (event?.participantsRegistered ?? 0) }}
  </p>
  <ng-container *ngIf="event.participantRegistrationPossible.option">
    <p
      *ngIf="user?.hasESNcard && event.discountedPrice"
      class="bg-green-600 text-white font-bold py-1 px-3 rounded mb-2"
    >
      Your ESNcard discount was applied!
    </p>
    <p class="pb-4">
      You can register for this event online by paying
      <strong *ngIf="!user?.hasESNcard || !event.discountedPrice">
        {{ event.price | currency: 'EUR' }}
      </strong>
      <strong *ngIf="user?.hasESNcard && event.discountedPrice">
        {{ event.discountedPrice | currency: 'EUR' }}
      </strong>
    </p>
    <ng-container *ngIf="userSetupForPayment$ | async; else notReady">
      <button
        mat-raised-button
        color="primary"
        (click)="register()"
        [disabled]="processing | async"
      >
        Pay and register
      </button>
      <mat-progress-bar
        class="mt-4"
        mode="indeterminate"
        *ngIf="processing | async"
      ></mat-progress-bar>
    </ng-container>
  </ng-container>
  <ng-container
    *ngIf="
      !event.participantRegistrationPossible.option && !event.userRegistered
    "
  >
    <p>
      {{ event.participantRegistrationPossible.reason }}
    </p>
  </ng-container>
  <ng-container *ngIf="event.userRegistered">
    <p>✔️ You are registered for this event.</p>
    <div class="my-2" *ngIf="!event.registration?.didAttend">
      <p class="mb-2">You can give this registration to another person</p>
      <button mat-flat-button (click)="moveEvent()">Send event</button>
    </div>
    <ng-container
      *ngIf="
        canDeregister &&
        !event.title.includes('ESNcard') &&
        !event.title.includes('Party')
      "
    >
      <p class="my-2">
        You can deregister from this event before
        {{ lastDeregistration | date }} and receive a refund
      </p>
      <button
        mat-flat-button
        color="warn"
        [disabled]="processing | async"
        (click)="deregister()"
      >
        Give up spot
      </button>
      <mat-progress-bar
        class="mt-4"
        mode="indeterminate"
        *ngIf="processing | async"
      ></mat-progress-bar>
    </ng-container>
  </ng-container>
  <ng-template #notReady>
    <h2 class="font-bold">⚠️ No payment method saved</h2>
    <p class="mb-4">
      To register for TUMi events you have to save a payment method to your
      profile
    </p>
    <a routerLink="/profile" mat-flat-button color="primary">
      Go to profile now
    </a>
  </ng-template>
</div>
