//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table Tenant {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  users UsersOfTenants [not null]
  name String [not null]
  shortName String [unique, not null]
  privacyPolicyPage String [not null, default: '']
  imprintPage String [not null, default: '']
  aboutPage String [not null, default: '']
  faqPage String
  eventTemplates EventTemplate [not null]
  organizers EventOrganizer [not null]
  refundedRegistrations RefundedRegistration [not null]
  products Product [not null]

  Note: 'One Tenant of the app, most likely an ESN section'
}

Table User {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  authId String [unique, not null, note: 'Id from auth0 for this user']
  firstName String [not null]
  lastName String [not null]
  email String [not null]
  email_verified Boolean [not null]
  phone String
  paypal String
  iban String
  picture String [not null]
  birthdate DateTime [not null]
  calendarToken String [unique, not null]
  tenants UsersOfTenants [not null]
  eventSubmissions EventSubmission [not null]
  eventRegistrations EventRegistration [not null]
  receipts Receipt [not null]
  createdEvents TumiEvent [not null]
  purchases ProductPurchase [not null]

  Note: 'One User of the app'
}

Table StripeUserData {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  userOfTenant UsersOfTenants [not null]
  usersOfTenantsUserId String [not null]
  usersOfTenantsTenantId String [not null]
  customerId String [not null]
  paymentMethodId String

  indexes {
    (usersOfTenantsUserId, usersOfTenantsTenantId) [unique]
  }
}

Table RefundedRegistration {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  eventId String [not null]
  userId String [not null]
  registrationId String [not null]
  chargeId String [not null]
  refundId String [not null]
  tenant Tenant [not null]
  tenantId String [not null]
}

Table UsersOfTenants {
  createdAt DateTime [default: `now()`, not null]
  user User [not null]
  userId String [not null]
  tenant Tenant [not null]
  tenantId String [not null]
  role Role [not null, default: 'USER']
  status MembershipStatus [not null, default: 'NONE']
  stripeData StripeUserData

  indexes {
    (userId, tenantId) [pk]
  }
}

Table EventOrganizer {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  tenant Tenant [not null]
  tenantId String [not null]
  name String [not null]
  text String [not null]
  link String
  events TumiEvent [not null]
}

Table EventTemplate {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  title String [not null]
  icon String [not null]
  description String [not null]
  comment String [not null]
  location String [not null]
  locationId String [not null]
  duration Decimal [not null]
  participantText String [not null]
  participantMail String [not null]
  organizerText String [not null]
  finances Json [not null]
  eventInstances TumiEvent [not null]
  tenant Tenant [not null]
  tenantId String [not null]
  category EventTemplateCategory
  categoryId String

  Note: 'Template that holds all information for an event that is needed to run it'
}

Table EventTemplateCategory {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  name String [not null]
  templates EventTemplate [not null]

  Note: 'Category to keep an overview of event templates'
}

Table TumiEvent {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  title String [not null]
  icon String [not null]
  start DateTime [not null]
  end DateTime [not null]
  description String [not null]
  location String [not null]
  locationId String [not null]
  participantText String [not null]
  participantMail String [not null]
  organizerText String [not null]
  participantLimit Int [not null, default: 0]
  organizerLimit Int [not null, default: 0]
  price Decimal
  registrationLink String
  registrationMode RegistrationMode [not null]
  publicationState PublicationState [not null, default: 'DRAFT']
  participantSignup MembershipStatus [not null]
  organizerSignup MembershipStatus [not null]
  submissionItems EventSubmissionItem [not null]
  registrations EventRegistration [not null]
  costItems CostItem [not null]
  photoShare PhotoShare
  organizer EventOrganizer [not null]
  eventOrganizerId String [not null]
  createdBy User [not null]
  creatorId String [not null]
  eventTemplate EventTemplate [not null]
  eventTemplateId String [not null]

  Note: 'Actual instande of an TumiEventbased on a template'
}

Table Product {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  title String [not null]
  icon String [not null]
  description String [not null]
  availability MembershipStatus [not null]
  prices ProductPrice [not null]
  tenant Tenant [not null]
  tenantId String [not null]
  purchases ProductPurchase [not null]
}

Table ProductPrice {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  amount Decimal [not null]
  availability MembershipStatus [not null]
  product Product [not null]
  productId String [not null]
  purchases ProductPurchase [not null]
}

Table ProductPurchase {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  product Product [not null]
  user User [not null]
  price ProductPrice [not null]
  productId String [not null]
  userId String [not null]
  productPriceId String [not null]
}

Table CostItem {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  event TumiEvent [not null]
  eventId String [not null]
  name String [not null]
  ammount Decimal [not null]
  receipts Receipt [not null]
}

Table Receipt {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  user User [not null]
  userId String [not null]
  costItem CostItem [not null]
  costItemId String [not null]
  covered Boolean [not null, default: false]
  amount Int [not null]
  date DateTime [not null]
  amountCovered Int [not null]
}

Table PhotoShare {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  event TumiEvent [not null]
  eventId String [not null]
}

Table EventRegistration {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  type RegistrationType [not null, default: 'PARTICIPANT']
  user User [not null]
  userId String [not null]
  event TumiEvent [not null]
  eventId String [not null]
  checkInTime DateTime
  paymentIntentId String
  chargeId String
  paymentStatus String
  stripeFee Int
  amountPaid Int
  netPaid Int
  moveOrders EventRegistrationMoveOrder [not null]

  indexes {
    (userId, eventId) [unique]
  }
}

Table EventRegistrationMoveOrder {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  createdBy String [not null]
  failed Boolean [not null, default: false]
  usedBy String
  usedAt DateTime
  registration EventRegistration [not null]
  eventRegistrationId String [not null]
}

Table EventSubmissionItem {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  event TumiEvent [not null]
  eventId String [not null]
  required Boolean [not null]
  submissionTime SubmissionTime [not null]
  submissions EventSubmission [not null]
}

Table EventSubmission {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  user User [not null]
  userId String [not null]
  submissionItem EventSubmissionItem [not null]
  submissionItemId String [not null]
}

Table ActivityLog {
  id String [pk]
  createdAt DateTime [default: `now()`, not null]
  message String [not null]
  data Json
  oldData Json
  involvedUser String
  severity LogSeverity [not null]
}

Enum Role {
  USER
  ADMIN
}

Enum MembershipStatus {
  NONE
  TRIAL
  FULL
  SPONSOR
  ALUMNI
}

Enum PublicationState {
  DRAFT
  APPROVAL
  ORGANIZERS
  PUBLIC
}

Enum SubmissionItemType {
  FILE
  NUMBER
  TEXT
  DATE
  RATING
}

Enum SubmissionTime {
  REGISTRATION
  BEFORE
  DURING
  AFTER
}

Enum RegistrationType {
  ORGANIZER
  PARTICIPANT
  CALENDAR
}

Enum RegistrationMode {
  STRIPE
  ONLINE
  EXTERNAL
}

Enum LogSeverity {
  SILLY
  DEBUG
  INFO
  WARNING
  ERROR
}

Ref: StripeUserData.(usersOfTenantsUserId, usersOfTenantsTenantId) - UsersOfTenants.(userId, tenantId)

Ref: RefundedRegistration.tenantId > Tenant.id

Ref: UsersOfTenants.userId > User.id

Ref: UsersOfTenants.tenantId > Tenant.id

Ref: EventOrganizer.tenantId > Tenant.id

Ref: EventTemplate.tenantId > Tenant.id

Ref: EventTemplate.categoryId > EventTemplateCategory.id

Ref: TumiEvent.eventOrganizerId > EventOrganizer.id

Ref: TumiEvent.creatorId > User.id

Ref: TumiEvent.eventTemplateId > EventTemplate.id

Ref: Product.tenantId > Tenant.id

Ref: ProductPrice.productId > Product.id

Ref: ProductPurchase.productId > Product.id

Ref: ProductPurchase.userId > User.id

Ref: ProductPurchase.productPriceId > ProductPrice.id

Ref: CostItem.eventId > TumiEvent.id

Ref: Receipt.userId > User.id

Ref: Receipt.costItemId > CostItem.id

Ref: PhotoShare.eventId - TumiEvent.id

Ref: EventRegistration.userId > User.id

Ref: EventRegistration.eventId > TumiEvent.id

Ref: EventRegistrationMoveOrder.eventRegistrationId > EventRegistration.id

Ref: EventSubmissionItem.eventId > TumiEvent.id

Ref: EventSubmission.userId > User.id

Ref: EventSubmission.submissionItemId > EventSubmissionItem.id